---
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';
import { getCollection } from 'astro:content';
import { getPopularPosts } from '../lib/getPopularPosts';
export const prerender = {
  expiration: 60 * 60 * 24, // 24時間
};

const posts = await getCollection('blog');
// 日付の降順に並べる
posts.sort((a, b) => b.data.pubDate - a.data.pubDate);
// 新着記事を表示
const latestPosts = posts.slice(0, 6);

// 人気記事を5件表示
const popularPosts = await getPopularPosts(6);

// カテゴリごとにグループ化
const categories = {};

for (const post of posts) {
  const cats = Array.isArray(post.data.category)
    ? post.data.category
    : [post.data.category];

  for (const cat of cats) {
    if (!cat) continue;
    if (!categories[cat]) categories[cat] = [];
    categories[cat].push(post);
  }
}

// カテゴリ別に新着4件を取得
const categorySections = {
  campgear: (categories["campgear"] ?? []).slice(0, 4),
  campsite: (categories["campsite"] ?? []).slice(0, 4),
  miscellaneous: (categories["miscellaneous"] ?? []).slice(0, 4),
  outdoor: (categories["outdoor"] ?? []).slice(0, 4),
};
---


<!doctype html>
<html lang="ja">
  <head>
    <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  </head>
  <body>
    <Header />  
    <!-- ヒーロー動画セクション -->
    <section class="hero">
      <!-- PC用動画 -->
      <video class="hero-video pc-video" autoplay muted loop playsinline>
        <source src="/videos/hero_main_pc.webm" type="video/mp4" />
      </video>
      <!-- スマホ用動画 -->
      <video class="hero-video sp-video" autoplay muted loop playsinline>
        <source src="/videos/hero_main_sp.webm" type="video/mp4" />
      </video>

      <div class="hero-overlay"></div>

      <div class="hero-content">
        <h1>アンデスライフへようこそ！</h1>
        <p>東北地方のキャンプ場とおいしいグルメを紹介します。</p>
      </div>
    </section>  

    <main>

    <!-- 新着記事/人気記事セクション -->
    <div class="bottom-space"></div>
    <h2 class="category-section-title"><span class="highlight">N</span>ew｜<span class="highlight">P</span>opular</h2>
    <h2 class="category-section-subtitle">～新着記事＆人気記事～</h2>

		<section class="post-switcher">
      <div class="tabs">
        <button class="tab active" data-target="new">新着</button>
        <button class="tab" data-target="popular">人気</button>
      </div>
      <!-- 新着記事 -->
      <div class="tab-content active" id="new">
        <div class="post-grid">
          {latestPosts.map(post => (
            <a href={`/${post.id}/`} class="post-card">
              <img src={post.data.heroImage?.src ?? "/default.jpg"} alt={post.data.title} />
              <div class="post-content">
                <span class={`post-category category-${post.data.category}`}>
                  {post.data.category}
                </span>
                <h3>{post.data.title}</h3>
                <p class="post-date"><i class="fa-regular fa-clock"></i> {post.data.pubDate.toLocaleDateString()}</p>
              </div>
            </a>
          ))}
        </div>
      </div>
      <!-- 人気記事 -->
      <div class="tab-content" id="popular">
        <div class="post-grid">
          {popularPosts.map(post => (
            <a href={`/${post.astro.id}/`} class="post-card">
              <img
                src={post.astro.data.heroImage?.src ?? "/default.jpg"}
                alt={post.astro.data.title}
              />

              <div class="post-content">
                <span class={`post-category category-${post.astro.data.category}`}>
                  {post.astro.data.category}
                </span>

                <h3>{post.astro.data.title}</h3>

                <p class="post-date">
                  <i class="fa-regular fa-clock"></i>
                  {post.astro.data.pubDate.toLocaleDateString()}
                </p>

                <p class="post-date">{post.pageviews} PV</p>
              </div>
            </a>
          ))}
        </div>
      <div class="bottom-space"></div>
    </section>

    <!-- カテゴリ別記事一覧セクション -->
    <div class="bottom-space"></div>
    <h2 class="category-section-title"><span class="highlight">C</span>ategory</h2>
    <h2 class="category-section-subtitle">～カテゴリー別記事～</h2>
    <section class="category-section">
      
      <!-- campsite -->
      <div class="category-block">
        <img src="/images/logos/campsite.png" alt="campsite" class="category-logo" />

        <div class="post-grid">
          {categorySections.campsite.map(post => (
            <a href={`/${post.id}`} class="post-card">
              <img src={post.data.heroImage?.src ?? "/default.jpg"} alt={post.data.title} />
              <div class="post-content">
                <span class={`post-category category-${post.data.category}`}>
                  {post.data.category}
                </span>
                <h3>{post.data.title}</h3>
                <p class="post-date"><i class="fa-regular fa-clock"></i> {post.data.pubDate.toLocaleDateString()}</p>
              </div>
            </a>
          ))}
        </div>
      </div>

      <!-- campgear -->
      <div class="category-block">
        <img src="/images/logos/campgear.png" alt="campgear" class="category-logo" />

        <div class="post-grid">
          {categorySections.campgear.map(post => (
            <a href={`/${post.id}`} class="post-card">
              <img src={post.data.heroImage?.src ?? "/default.jpg"} alt={post.data.title} />
              <div class="post-content">
                <span class={`post-category category-${post.data.category}`}>
                  {post.data.category}
                </span>
                <h3>{post.data.title}</h3>
                <p class="post-date"><i class="fa-regular fa-clock"></i> {post.data.pubDate.toLocaleDateString()}</p>
              </div>
            </a>
          ))}
        </div>
      </div>

      <!-- outdoor -->
      <div class="category-block">
        <div class="logo-center">
          <img src="/images/logos/outdoor.png" alt="outdoor" class="category-logo" />
        </div>
        <div class="post-grid">
          {categorySections.outdoor.map(post => (
            <a href={`/${post.id}`} class="post-card">
              <img src={post.data.heroImage?.src ?? "/default.jpg"} alt={post.data.title} />
              <div class="post-content">
                <span class={`post-category category-${post.data.category}`}>
                  {post.data.category}
                </span>
                <h3>{post.data.title}</h3>
                <p class="post-date"><i class="fa-regular fa-clock"></i> {post.data.pubDate.toLocaleDateString()}</p>
              </div>
            </a>
          ))}
        </div>
      </div>

      <!-- miscellaneous -->
      <div class="category-block">
        <img src="images//logos/miscellaneous.png" alt="miscellaneous" class="category-logo" />

        <div class="post-grid">
          {categorySections.miscellaneous.map(post => (
            <a href={`/${post.id}`} class="post-card">
              <img src={post.data.heroImage?.src ?? "/default.jpg"} alt={post.data.title} />
              <div class="post-content">
                <span class={`post-category category-${post.data.category}`}>
                  {post.data.category}
                </span>
                <h3>{post.data.title}</h3>
                <p class="post-date"><i class="fa-regular fa-clock"></i> {post.data.pubDate.toLocaleDateString()}</p>
              </div>
            </a>
          ))}
        </div>
      </div>      
    </section>
    <!-- ----------プロフィールセクション---------- -->
    <div class="bottom-space"></div>
    <h2 class="category-section-title"><span class="highlight">P</span>rofile</h2>
    <h2 class="category-section-subtitle">～プロフィール～</h2>
    <section class="profile-section">
      <div class="profile-grid">
<!-- 1人目プロフィール -->
        <div class="profile-card">
          <img src="/src/assets/images/kiritan_profile.jpg" alt="profile" class="profile-image" />

          <h2 class="profile-name">kiritan</h2>
          <p class="profile-subname">わたしが編集者のアシクサだ。 </p>

          <p class="profile-text">
            アウトドア好きの一般男性、仕事より趣味が生きがい。<br>
            趣味はキャンプ、スノボ、そしてゲーム。<br>
            春～秋はキャンプをして冬期は雪山に生息している。
          </p>
          <div class="profile-links">
            <a href="https://twitter.com/" target="_blank">Twitter</a>
            <a href="https://instagram.com/" target="_blank">Instagram</a>
          </div>
        </div>

<!-- 2人目プロフィール -->
        <div class="profile-card">
          <img src="/src/assets/images/sena_profile.png" alt="profile" class="profile-image" />

          <h2 class="profile-name">sena</h2>
          <p class="profile-subname">アシスタントとアシクサの飼い主。 </p>

          <p class="profile-text">
            飛行タイプの昆虫に弱い。ポケモンでいうと草タイプ。<br>
            キャンプ場で遭遇するトンボが大の苦手。すぐに逃げる。<br>
            ドラクエ７リイマジンドはアーリーアクセスを購入。            
          </p>
          <div class="profile-links">
            <!-- <a href="https://twitter.com/" target="_blank">Twitter</a>
            <a href="https://instagram.com/" target="_blank">Instagram</a> -->
          </div>
        </div>    
      </div>
    </section>

    </main>
    <Footer />

    <script>
    document.querySelectorAll('.tab').forEach(tab => {
    tab.addEventListener('click', () => {
    // タブの active 切り替え
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    tab.classList.add('active');

    // コンテンツの切り替え
    const target = tab.dataset.target;
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    document.getElementById(target).classList.add('active');
    });
    });
    </script>

  </body>
</html>

<style>
/* -------------  共通仕様css----------------- */
body {
  font-family: "Noto Sans JP", sans-serif;
}
.bottom-space{
    margin-bottom: 5rem;
}

/* ----------ヒーロー動画セクション---------- */
/* まず両方非表示にしておく */
.pc-video,
.sp-video {
  display: none;
}

/* PC用（768px以上） */
@media (min-width: 768px) {
  .pc-video {
    display: block;
  }
}

/* スマホ用（768px未満） */
@media (max-width: 768px) {
  .sp-video {
    display: block;
  }
}

/* まず両方非表示にしておく */
.hero {
  position: relative;
  width: 100%;
  height: 100vh;
  min-height: 480px;
  overflow: hidden;
}

/* 背景動画（PC/スマホ共通） */
.hero-video {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  filter: brightness(0.85) contrast(0.95) saturate(1.15);
}

/* andes-life っぽい黒フィルター */
.hero-overlay {
  position: absolute;
  inset: 0;
  background: rgba(249, 167, 52, 0.05);
  backdrop-filter: blur(0.5px);
}

/* テキスト */
.hero-content {
  position: relative;
  z-index: 2;
  text-align: center;
  top: 50%;
  transform: translateY(-50%);
}

.hero-content h1 {
  font-size: 1.8rem;
  font-weight: 400;
  margin-bottom: 1.9rem;
  letter-spacing: 0.05em;
  color: #fff;
}

.hero-content p {
  font-size: 1.2rem;
  opacity: 0.9;
  color: #fff;
}

/* ----------新着記事セクション---------- */
.new-posts {
  margin-bottom: 3rem;
}

/* グリッドレイアウト */
.post-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 1.8rem;
}

/* カード全体 */
.post-card {
  display: block;
  background: #fff;
  border-radius: 0px; /* 丸み */
  overflow: hidden;
  text-decoration: none;
  color: inherit;
  box-shadow: 0 4px 14px rgba(0,0,0,0.08);
  transition: transform 0.25s ease, box-shadow 0.25s ease;
}

/* ホバー時の浮き上がり */
.post-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 10px 24px rgba(0,0,0,0.12);
}

/* 画像（16:9） */
.post-card img {
  width: 100%;
  aspect-ratio: 16 / 9;
  object-fit: cover;
  border-radius: 0px; /* 丸み */

}

/* カード内のテキスト部分 */
.post-content {
  padding: 1rem 1.2rem 1.3rem;
}

/* カテゴリバッジ */
.post-category {
  display: inline-block;
  font-size: 0.75rem;
  padding: 0.2rem 0.6rem;
  background: #f2f2f2;
  border-radius: 6px;
  color: #666;
  margin-bottom: 0.5rem;
}

/* タイトル */
.post-content h3 {
  font-size: 1.1rem;
  margin: 0.4rem 0 0.6rem;
  line-height: 1.4;
  font-weight: 600;
}

/* 日付 */
.post-date {
  font-size: 0.8rem;
  color: #999;
}

/* タブ切り替え */
.tabs {
  display: flex;
  gap: 1rem;
  margin-bottom: 1.2rem;
}
.tab {
  padding: 0.5rem 1.2rem;
  border: none;
  background: #f2f2f2;
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.9rem;
}
.tab.active {
  background: #333;
  color: #fff;
}

/* タブ切り替え（display を使わない） */
.tab-content {
  visibility: hidden;
  opacity: 0;
  height: 0;
  overflow: hidden;
  transition: opacity 0.25s ease, visibility 0.25s ease, height 0.25s ease;
}

.tab-content.active {
  visibility: visible;
  opacity: 1;
  height: auto;
  overflow: visible;
}

/* タブ切り替えアニメーション */
/* 初期状態（非表示） */
.tab-content:not(.active) .post-card {
  opacity: 0;
  transform: translateY(6px);
}

/* active のときだけアニメーション */
.tab-content.active .post-card {
  opacity: 1;
  transform: translateY(0);
  transition: opacity 0.28s ease, transform 0.28s ease;
}


/* 順番に遅延 */
.tab-content.active .post-card:nth-child(1) { transition-delay: 0.05s; }
.tab-content.active .post-card:nth-child(2) { transition-delay: 0.10s; }
.tab-content.active .post-card:nth-child(3) { transition-delay: 0.15s; }
.tab-content.active .post-card:nth-child(4) { transition-delay: 0.20s; }
.tab-content.active .post-card:nth-child(5) { transition-delay: 0.25s; }
.tab-content.active .post-card:nth-child(6) { transition-delay: 0.30s; }


/* ---------------カテゴリ記事セクション------------------- */

/* CATEGORY 見出し（中央） */
.category-section-title {
  text-align: center;
  font-size: 1.7rem;
  font-weight: 700;
  color: #101010;
  letter-spacing: 0.10em;
  margin-top: 10rem;
  margin-bottom: 0.5rem;
  /* text-transform: uppercase; */
}
.category-section-title .highlight {
  color: #33bfa1;
}
.category-section-subtitle {
  text-align: center;
  font-size: 1rem;
  font-weight: 700;
  color: #636262;
  letter-spacing: 0.12em;
  margin-bottom: 3rem;
}
/* --------------- カテゴリ記事セクション（.ver2） ------------------- */

.category-section {
  margin-top: 3rem;
  display: grid;
  grid-template-columns: repeat(2, 1fr); /* 2x2カラム */
  gap: 8rem 5rem; /* 縦の間隔を少し広めに */
}

/* ② ロゴを中央に配置 */
.category-block {
  display: flex;
  flex-direction: column;
  align-items: center; /* これで子要素（ロゴとリスト）が中央に寄る */
}

.category-logo {  
  width: 260px;
  height: auto;
  margin-bottom: 2rem;
  display: block;
}

/* ① カテゴリー内の記事カードを横並び（左画像・右テキスト）にする */
.category-block .post-grid {
  display: flex;
  flex-direction: column; /* 縦に並べる（カード自体は横長） */
  gap: 1.2rem;
  width: 100%; /* 親の幅いっぱいに広げる */
}

.category-block .post-card {
  display: flex; /* ここで画像とテキストを横並びに */
  align-items: center;
  gap: 1rem;
  background: transparent; /* 背景なしの方がスッキリします */
  box-shadow: none;
  border-radius: 0;
}

.category-block .post-card:hover {
  transform: translateX(5px); /* 横にスライドするホバー演出 */
}

.category-block .post-card img {
  width: 250px; /* 画像の幅を固定 */
  height: 150px;
  aspect-ratio: 16 / 9;
  border-radius: 8px; /* 角を少し丸く */
  flex-shrink: 0; /* 画像が潰れないように固定 */
}

.category-block .post-content {
  padding: 0;
}

/* カテゴリー内の記事ではバッジを非表示にする（ロゴでわかるため） */
.category-block .post-category {
  display: none;
}

.category-block .post-content h3 {
  font-size: 0.95rem; /* 少し小さめに調整 */
  margin: 0 0 0.2rem 0;
  display: -webkit-box;
  -webkit-line-clamp: 3; /* 2行以上は省略 */
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.category-block .post-date {
  font-size: 0.75rem;
}

/* スマホ対応：1列にする */
@media (max-width: 768px) {
  .category-section {
    grid-template-columns: 1fr;
  }
}

/* カテゴリ全体を 2×2 グリッドに */
/* .category-section {
  margin-top: 3rem;
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 3rem 1rem;
} */

/* 各カテゴリブロック */
/* .category-block {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
} */

/* ロゴ */
/* .category-logo {  
  width: 250px;
  height: auto;
  margin-bottom: 1rem;
} */

/* 記事グリッド（既存の post-grid をそのまま使う） */
/* .category-block .post-grid {
  margin-top: 0.5rem;
} */

/* ----------プロフィールセクション---------- */
.profile-section {
  margin-top: 4rem;
  padding: 2.5rem 1rem;
  background: #fafafa;
  border-radius: 12px;
}
/* 横並びレイアウト */
.profile-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 2.5rem;
  max-width: 900px;
  margin: 0 auto;
}
/* 各プロフィールカード */
.profile-card {
  text-align: center;
  padding: 1rem;
}
/* 画像 */
.profile-image {
  width: 120px;
  height: 120px;
  border-radius: 50%;
  object-fit: cover;
  margin-bottom: 1rem;
}
/* 名前 */
.profile-name {
  font-size: 1.4rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
}
.profile-subname {
  font-size: 1.0rem;
  font-weight: 450;
  margin-bottom: 0.5rem;
  color: #0a0a0a
}

.profile-text {
  font-size: 0.95rem;
  color: #555;
  line-height: 1.6;
  margin-bottom: 1.2rem;
}

.profile-links a {
  margin: 0 0.5rem;
  color: #333;
  font-weight: 600;
  text-decoration: none;
}

.profile-links a:hover {
  text-decoration: underline;
}

</style>

